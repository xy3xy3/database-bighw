# AGENT-LLM

## 项目介绍

使用向量数据库加上非阻塞IO开发的一套兼容OpenAI后端chat接口的RAG智能体平台,可以用于私有知识库智能大模型客服等项目.

利用RAG技术在某些方面可以代替微调大模型，训练私有知识并减少不必要的成本.

## 技术概览

### 数据库

使用安装了DataVec向量引擎插件的openGauss数据库

### 后端

- 基于Python fastapi开发,使用非阻塞式协程

- 用`psycopg3`协程链接数据库

- 封装统一`Model`接口对接数据表,减少重复sql撰写

- 通过`AsyncOpenAI`库链接兼容OpenAI接口的国产大模型平台`DeepSeek`,`智谱`

- 根据OpenAI接口规范,模拟出了他们的`chat`接口,方便任何支持对接OpenAI的项目使用我们API

### 前端

- 后台使用`LayuiAdmin`配合`Jinja2`模板引擎

- 前台使用Github上的`chatgpt-web`做了一定修改对接后端API,传递对话id

## 数据表介绍

![](./img/er.png)

### `message` 表
存储对话内容，包含以下字段：
- `id`: 主键，自增序列，唯一标识每条消息。
- `created_at`: 消息创建时间，默认值为当前时间。
- `session_id`: 对话会话ID，用于标识同一对话中的消息。
- `role`: 消息的角色，例如用户、系统、助手等。
- `content`: 消息内容，存储对话的具体文本。

### `model` 表
存储模型信息，包含以下字段：
- `id`: 主键，自增序列，唯一标识每个模型。
- `name`: 模型名称，用于标识模型的名称。
- `base_url`: 模型的基础URL，用于调用模型的API。
- `api_key`: 模型的API密钥，用于身份验证。
- `model_type`: 模型类型，标识模型是用于嵌入（0）还是对话（1）。

### `knowledgebase` 表
存储知识库信息，包含以下字段：
- `id`: 主键，自增序列，唯一标识每个知识库。
- `name`: 知识库名称，用于标识知识库的名称。
- `description`: 知识库描述，用于描述知识库的内容。
- `model_id`: 外键，引用 `model` 表的 `id`，标识知识库使用的模型。

### `knowledge_content` 表
存储知识库的内容，包含以下字段：
- `id`: 主键，自增序列，唯一标识每条知识内容。
- `base_id`: 外键，引用 `knowledgebase` 表的 `id`，标识该内容所属的知识库。
- `content`: 知识内容，存储具体的知识文本。
- `embedding`: 向量字段，存储知识内容的向量表示。
- `created_at`: 创建时间，默认值为当前时间。

### `config` 表
存储系统配置信息，包含以下字段：
- `k`: 配置键，主键，唯一标识每个配置项。
- `v`: 配置值，存储配置的具体值。

### `agent` 表
存储智能体信息，包含以下字段：
- `id`: 主键，自增序列，唯一标识每个智能体。
- `name`: 智能体名称，用于标识智能体的名称。
- `base_ids`: 知识库ID列表，标识智能体关联的知识库。
- `top_n`: 引用token上限，标识智能体在生成答案时引用的最大token数。
- `q_model_id`: 外键，引用 `model` 表的 `id`，标识用于问题优化的模型。
- `q_prompt`: 问题优化的提示，用于指导问题优化模型的输入。
- `a_model_id`: 外键，引用 `model` 表的 `id`，标识用于答案生成的模型。
- `a_prompt`: 答案生成的提示，用于指导答案生成模型的输入。

## 功能实现

### 前端对话

### 后台表格增删改查

### 知识上传

### RAG搜索

### 模拟OpenAI对话接口

## 特别鸣谢

以下排名不分先后

- OpenGauss [https://docs.opengauss.org/zh/docs/latest/docs/AboutopenGauss/DataVec%E5%90%91%E9%87%8F%E5%BC%95%E6%93%8E.html](https://docs.opengauss.org/zh/docs/latest/docs/AboutopenGauss/DataVec%E5%90%91%E9%87%8F%E5%BC%95%E6%93%8E.html)

- Layui组件库  [https://layui.dev/](https://layui.dev/)

- FastApi [https://fastapi.tiangolo.com/zh/](https://fastapi.tiangolo.com/zh/)

- chatgpt-web [https://github.com/xqdoo00o/chatgpt-web](https://github.com/xqdoo00o/chatgpt-web)

- deepseek [https://platform.deepseek.com/](https://platform.deepseek.com/)

- 智谱AI [https://bigmodel.cn/](https://bigmodel.cn/)

